{"mappings":"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","sources":["packages/artplayer-plugin-pip/src/index.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["export default function artplayerPluginPip(userOptions = {}) {\n  const options = {\n    width: 480,\n    height: 270,\n    placeholder: `Playing in Document Picture-in-Picture`,\n    ...userOptions,\n  }\n\n  return (art) => {\n    if (!('documentPictureInPicture' in window)) {\n      art.notice.show = 'Document Picture-in-Picture is not supported'\n      return\n    }\n\n    const { proxy, icons, i18n, template: { $container }, constructor: { utils: { append, tooltip } } } = art\n\n    const state = {\n      win: null,\n      originalParent: null,\n      originalNext: null,\n      currentDoc: null,\n      placeholder: null,\n    }\n\n    function copyStylesTo(targetDoc) {\n      const baseStyle = `\n            html, body { margin:0; padding:0; width:100%; height:100%; background:#000; overflow:hidden; }\n            #__art_dpip_root { position:absolute; inset:0; display:flex; }\n            #__art_dpip_root > * { width:100% !important; height:100% !important; }\n        `\n\n      const $style = document.querySelector('#artplayer-style')\n      const clone = targetDoc.createElement('style')\n      clone.textContent = baseStyle + $style.textContent\n      targetDoc.head.appendChild(clone)\n\n      const meta = targetDoc.createElement('meta')\n      meta.name = 'viewport'\n      meta.content = 'width=device-width,initial-scale=1'\n      targetDoc.head.appendChild(meta)\n    }\n\n    async function open() {\n      if (state.win)\n        return\n\n      try {\n        const pipWin = await window.documentPictureInPicture.requestWindow({\n          width: options.width,\n          height: options.height,\n        })\n\n        state.win = pipWin\n        state.currentDoc = pipWin.document\n\n        state.placeholder = document.createElement('div')\n        state.placeholder.className = 'artplayer-pip-placeholder'\n        state.placeholder.style.cssText = `display:flex;justify-content:center;align-items:center;width:100%;height:100%;`\n        state.placeholder.textContent = options.placeholder\n        state.originalParent = $container.parentNode\n        state.originalNext = $container.nextSibling\n        state.originalParent.insertBefore(state.placeholder, state.originalNext)\n\n        const root = pipWin.document.createElement('div')\n        root.id = '__art_dpip_root'\n        pipWin.document.body.appendChild(root)\n\n        copyStylesTo(pipWin.document)\n\n        const adopted = pipWin.document.adoptNode($container)\n        root.appendChild(adopted)\n        state.currentDoc = pipWin.document\n\n        const onResize = () => art.resize?.()\n        const onPageHide = () => close()\n\n        pipWin.addEventListener('resize', onResize)\n        pipWin.addEventListener('pagehide', onPageHide)\n\n        state.cleanup = () => {\n          pipWin.removeEventListener('resize', onResize)\n          pipWin.removeEventListener('pagehide', onPageHide)\n        }\n\n        art.emit('document-pip', true)\n      }\n      catch (err) {\n        art.notice.show = 'Document Picture-in-Picture open failed'\n        console.warn('[artplayer-plugin-pip] open failed:', err)\n      }\n    }\n\n    function restoreToOriginalDocument() {\n      if (!state.placeholder)\n        return\n      const backDoc = state.placeholder.ownerDocument || document\n      const adoptedBack = backDoc.adoptNode($container)\n      state.originalParent.insertBefore(adoptedBack, state.placeholder)\n      state.placeholder.remove()\n      state.placeholder = null\n      state.currentDoc = backDoc\n    }\n\n    function close() {\n      if (!state.win)\n        return\n      try {\n        state.cleanup?.()\n        restoreToOriginalDocument()\n        state.win.close()\n        state.win = null\n        art.emit('document-pip', false)\n      }\n      catch (err) {\n        art.notice.show = 'Document Picture-in-Picture close failed'\n        console.warn('[artplayer-plugin-pip] close failed:', err)\n      }\n    }\n\n    function toggle() {\n      if (state.win) {\n        close()\n      }\n      else {\n        open()\n      }\n    }\n\n    art.controls.add({\n      name: 'document-pip',\n      position: 'right',\n      index: 40,\n      tooltip: art.i18n.get('PIP Mode'),\n      mounted: ($control) => {\n        append($control, icons.pip)\n        proxy($control, 'click', toggle)\n        art.on('document-pip', (value) => {\n          tooltip($control, i18n.get(value ? 'Exit PIP Mode' : 'PIP Mode'))\n        })\n      },\n    })\n\n    art.on('destroy', close)\n\n    return {\n      name: 'artplayerPluginPip',\n      open,\n      close,\n      toggle,\n    }\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.artplayerPluginPip = artplayerPluginPip\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}