{"mappings":"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","sources":["packages/artplayer-plugin-ads/src/index.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["export default function artplayerPluginAds(option) {\n    return (art) => {\n        const {\n            template: { $player },\n            constructor: {\n                utils: { append, setStyles },\n            },\n        } = art;\n\n        let $ads = null;\n        let $video = null;\n        let $control = null;\n        let blobUrl = null;\n        let playing = false;\n\n        function skip() {\n            pause();\n            art.play();\n            setStyles($ads, { display: 'none' });\n            art.emit('artplayerPluginAds:skip');\n        }\n\n        async function play() {\n            setStyles($ads, { display: null });\n\n            if (art.playing) art.pause();\n\n            try {\n                playing = true;\n                await $video.play();\n            } catch (error) {\n                $video.muted = true;\n                $video.play();\n            }\n\n            art.emit('artplayerPluginAds:play');\n        }\n\n        function pause() {\n            playing = false;\n            $video.pause();\n            art.emit('artplayerPluginAds:pause');\n        }\n\n        function update() {\n            art.emit('artplayerPluginAds:update', {\n                currentTime: $video.currentTime,\n                duration: $video.duration,\n            });\n        }\n\n        function createAds() {\n            const $ads = append($player, '<div></div>');\n\n            setStyles($ads, {\n                position: 'absolute',\n                zIndex: '150',\n                inset: 0,\n                width: '100%',\n                height: '100%',\n                overflow: 'hidden',\n                backgroundColor: '#000',\n            });\n\n            return $ads;\n        }\n\n        function createVideo($ads) {\n            const $video = append(\n                $ads,\n                `<video src=\"${blobUrl || option.url}\" poster=\"${blobUrl ? '' : option.poster}\" loop playsInline />`,\n            );\n\n            setStyles($video, {\n                width: '100%',\n                height: '100%',\n                objectFit: 'contain',\n            });\n\n            art.proxy($video, 'error', skip);\n            art.proxy($video, 'canplay', play);\n            art.proxy($video, 'timeupdate', update);\n            art.proxy($video, 'click', () => {\n                playing ? pause() : play();\n                art.emit('artplayerPluginAds:click');\n            });\n\n            return $video;\n        }\n\n        function createControl($ads) {\n            const $control = append($ads, `<div>5</div>`);\n\n            setStyles($control, {\n                position: 'absolute',\n                zIndex: 10,\n                right: '0px',\n                bottom: '30px',\n                lineHeight: 1,\n                padding: '5px 8px',\n                border: '1px solid #fff',\n                backgroundColor: '#000',\n                borderRight: 'none',\n                fontSize: '15px',\n                opacity: '0.5',\n            });\n\n            art.events.hover(\n                $control,\n                () => {\n                    setStyles($control, {\n                        opacity: '1',\n                    });\n                },\n                () => {\n                    setStyles($control, {\n                        opacity: '0.5',\n                    });\n                },\n            );\n\n            return $control;\n        }\n\n        function init() {\n            if ($ads || !option.url) return;\n            art.pause();\n            $ads = createAds();\n            $video = createVideo($ads);\n            $control = createControl($ads);\n            art.emit('artplayerPluginAds:mounted', { $ads, $video, $control });\n\n            if (option.mounted) {\n                option.mounted.call(art.plugins.artplayerPluginAds, $ads, $video, $control);\n            }\n        }\n\n        art.on('ready', () => {\n            art.once('play', init);\n            art.once('video:timeupdate', init);\n        });\n\n        if (option.preload) {\n            (async function preload() {\n                const blob = await (await fetch(option.url)).blob();\n                blobUrl = URL.createObjectURL(blob);\n                art.emit('artplayerPluginAds:preload', blobUrl);\n            })();\n        }\n\n        return {\n            name: 'artplayerPluginAds',\n            skip,\n            pause,\n            play,\n            get playing() {\n                return playing;\n            },\n            get $ads() {\n                return $ads;\n            },\n            get $video() {\n                return $video;\n            },\n            get $control() {\n                return $control;\n            },\n        };\n    };\n}\n\nartplayerPluginAds.env = process.env.NODE_ENV;\nartplayerPluginAds.version = process.env.APP_VER;\nartplayerPluginAds.build = process.env.BUILD_DATE;\n\nif (typeof window !== 'undefined') {\n    window['artplayerPluginAds'] = artplayerPluginAds;\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (key === 'default' || key === '__esModule' || dest.hasOwnProperty(key)) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}